{-
  where
    -- create a new metavariable
    Î¼sâ‚€ = Î¼s âŠ” st

    Î±áµ˜ : â„’HMType âŸ¨ st âŸ©
    Î±áµ˜ = var incl

    Î±â‚€ : â„’HMType âŸ¨ Î¼sâ‚€ âŠ” âŠ¥ âŸ©
    Î±â‚€ = Î±áµ˜ â‡ƒ[ Î¹â‚ â—† Î¹â‚€ ]â‡‚

    -- create the context which contains this new variable
    Î“â‚€ : â„’HMCtxFor Q Î¼sâ‚€
    Î“â‚€ = Î“ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ

    Ïƒâ‚€ : Î¼s âŸ¶ Î¼s âŠ” st
    Ïƒâ‚€ = Î¹â‚€

    Î“<Î“â‚€ : Î“ <Î“ Î“â‚€
    Î“<Î“â‚€ = record { fst = Î¹â‚€ ; snd = refl-â‰¡ }

    -- call typechecking recursively on `te`
    res = Î³ (Î±â‚€ âˆ· Î“â‚€) te

    -- computing the initial typing instance
    -- assuming we have one for te
    success : InitialCtxTypingInstance (Î±â‚€ âˆ· Î“â‚€) te -> InitialCtxTypingInstance Î“ (lam te)
    success ((Î¼sâ‚â‚ / Î¼sâ‚â‚“ âŠ© (Î±â‚ âˆ· Î“â‚) , Î²â‚ , Î±â‚€Î“â‚€<Î±â‚Î“â‚ , Î±â‚Î“â‚âŠ¢Î²â‚) , Î©) = {!!} , {!!} -- ğ‘‡ , isInitial:ğ‘‡
      where
        Ïƒáµƒâ‚€â‚ : Î¼sâ‚€ âŸ¶ Î¼sâ‚â‚
        Ïƒáµƒâ‚€â‚ = Î±â‚€Î“â‚€<Î±â‚Î“â‚ .fst

        Î“â‚€<Î“â‚ : Î“â‚€ <Î“ Î“â‚
        Î“â‚€<Î“â‚ = tail-Someâ„’HMCtx (Î±â‚€Î“â‚€<Î±â‚Î“â‚)

        f : Î¼s âŸ¶ Î¼sâ‚â‚
        f = Î¹â‚€ â—† Ïƒáµƒâ‚€â‚

        factor:f = factorize f

        Î¼sâ‚‚â‚ = image factor:f
        Î¼sâ‚‚â‚“ = rest factor:f
        Î¼sâ‚‚ = Î¼sâ‚‚â‚ âŠ” Î¼sâ‚‚â‚“

        Ïƒáµƒáµ¤â‚‚ : Î¼s âŸ¶ Î¼sâ‚‚â‚
        Ïƒáµƒáµ¤â‚‚ = epiHom factor:f

        Ï• : Î¼sâ‚‚ â‰… Î¼sâ‚â‚
        Ï• = splitting factor:f

        lem-0 : Î¹â‚€ â—† Ïƒáµƒâ‚€â‚ â—† âŸ¨ Ï• âŸ©â»Â¹ âˆ¼ Ïƒáµƒáµ¤â‚‚ â—† Î¹â‚€
        lem-0 = factors factor:f


        -- Ïƒáµ¤â‚ : Î¼s âŸ¶ Î¼sâ‚
        -- Ïƒáµ¤â‚ = Ïƒâ‚€ â—† Ïƒâ‚€â‚

        -- Î“<Î“â‚ : Î“ <Î“ Î“â‚
        -- Î“<Î“â‚ = Î“<Î“â‚€ âŸ¡ tail-Someâ„’HMCtx Î±â‚€Î“â‚€<Î±â‚Î“â‚

        Î“â‚‚ = Î“ â‡ƒ[ Ïƒáµƒáµ¤â‚‚ ]â‡‚á¶œ

        ã‚ : (Î¼sâ‚‚â‚ âŠ” Î¼sâ‚‚â‚“) âŠ” Î¼sâ‚â‚“ â‰… Î¼sâ‚‚â‚ âŠ” (Î¼sâ‚‚â‚“ âŠ” Î¼sâ‚â‚“)
        ã‚ = assoc-l-âŠ”-â„’HMTypes

        Ïˆâ»Â¹ : (Î¼sâ‚â‚ âŠ” Î¼sâ‚â‚“) âŸ¶ Î¼sâ‚‚â‚ âŠ” (Î¼sâ‚‚â‚“ âŠ” Î¼sâ‚â‚“)
        Ïˆâ»Â¹ = (âŸ¨ Ï• âŸ©â»Â¹ â‡ƒâŠ”â‡‚ id) â—† âŸ¨ ã‚ âŸ©

        Î±â‚‚ : â„’HMType âŸ¨ Î¼sâ‚‚â‚ âŠ” (Î¼sâ‚‚â‚“ âŠ” Î¼sâ‚â‚“) âŸ©
        Î±â‚‚ = Î±â‚ â‡ƒ[ â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜ ]â‡‚


        Î²â‚‚ : â„’HMType âŸ¨ Î¼sâ‚‚â‚ âŠ” (Î¼sâ‚‚â‚“ âŠ” Î¼sâ‚â‚“) âŸ©
        Î²â‚‚ = Î²â‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚

        postulate lem-03 : Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ â—† (Î¹â‚€ â—† Ïˆâ»Â¹)) âˆ¼ Ïƒáµƒáµ¤â‚‚ â—† Î¹â‚€
        {-
        lem-03 = Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ â—† (Î¹â‚€ â—† ((âŸ¨ Ï• âŸ©â»Â¹ â‡ƒâŠ”â‡‚ id) â—† âŸ¨ ã‚ âŸ©)))

                 âŸ¨ refl â—ˆ (refl â—ˆ assoc-r-â—† ) âŸ©-âˆ¼

                 Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ â—† (Î¹â‚€ â—† (âŸ¨ Ï• âŸ©â»Â¹ â‡ƒâŠ”â‡‚ id) â—† âŸ¨ ã‚ âŸ©))

                 âŸ¨ refl â—ˆ (refl â—ˆ (reduce-Î¹â‚€ â—ˆ refl) ) âŸ©-âˆ¼

                 Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ â—† (âŸ¨ Ï• âŸ©â»Â¹ â—† Î¹â‚€ â—† âŸ¨ ã‚ âŸ©))

                 âŸ¨ refl â—ˆ (refl â—ˆ (assoc-l-â—†) ) âŸ©-âˆ¼

                 Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ â—† (âŸ¨ Ï• âŸ©â»Â¹ â—† (Î¹â‚€ â—† âŸ¨ ã‚ âŸ©)))

                 âŸ¨ refl â—ˆ (assoc-r-â—†) âŸ©-âˆ¼

                 Î¹â‚€ â—† ((Ïƒáµƒâ‚€â‚ â—† âŸ¨ Ï• âŸ©â»Â¹) â—† (Î¹â‚€ â—† âŸ¨ ã‚ âŸ©))

                 âŸ¨ (assoc-r-â—†) âŸ©-âˆ¼

                 (Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ â—† âŸ¨ Ï• âŸ©â»Â¹)) â—† (Î¹â‚€ â—† âŸ¨ ã‚ âŸ©)

                 âŸ¨ (assoc-r-â—†) â—ˆ refl âŸ©-âˆ¼

                 ((Î¹â‚€ â—† Ïƒáµƒâ‚€â‚) â—† âŸ¨ Ï• âŸ©â»Â¹) â—† (Î¹â‚€ â—† âŸ¨ ã‚ âŸ©)

                 âŸ¨ lem-0 â—ˆ refl âŸ©-âˆ¼

                 (Ïƒáµƒáµ¤â‚‚ â—† Î¹â‚€) â—† (Î¹â‚€ â—† âŸ¨ ã‚ âŸ©)

                 âŸ¨ assoc-l-â—† âŸ©-âˆ¼

                 Ïƒáµƒáµ¤â‚‚ â—† (Î¹â‚€ â—† (Î¹â‚€ â—† âŸ¨ ã‚ âŸ©))

                 âŸ¨ refl â—ˆ assoc-r-â—† âŸ©-âˆ¼

                 Ïƒáµƒáµ¤â‚‚ â—† ((Î¹â‚€ â—† Î¹â‚€) â—† âŸ¨ ã‚ âŸ©)

                 âŸ¨ refl â—ˆ {!!} âŸ©-âˆ¼

                 Ïƒáµƒáµ¤â‚‚ â—† Î¹â‚€

                 âˆ
        -}

        postulate lem-04a : Î“â‚ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚á¶œ â‰¡ Î“ â‡ƒ[ Ïƒáµƒáµ¤â‚‚ ]â‡‚á¶œ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ
        {-
        lem-04a = Î“â‚ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚á¶œ      âŸ¨ functoriality-â—†-â‡ƒ[]â‡‚-CtxFor {Î“ = Î“â‚} {f = Î¹â‚€} {Ïˆâ»Â¹} âŸ©-â‰¡
                  Î“â‚ â‡ƒ[ Î¹â‚€ â—† Ïˆâ»Â¹ ]â‡‚á¶œ           âŸ¨ cong _â‡ƒ[ Î¹â‚€ â—† Ïˆâ»Â¹ ]â‡‚á¶œ (sym-Path (snd Î“â‚€<Î“â‚)) âŸ©-â‰¡
                  Î“ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ â‡ƒ[ Ïƒáµƒâ‚€â‚ ]â‡‚á¶œ â‡ƒ[ Î¹â‚€ â—† Ïˆâ»Â¹ ]â‡‚á¶œ   âŸ¨ functoriality-â—†-â‡ƒ[]â‡‚-CtxFor âŸ©-â‰¡
                  Î“ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ â‡ƒ[ Ïƒáµƒâ‚€â‚ â—† (Î¹â‚€ â—† Ïˆâ»Â¹) ]â‡‚á¶œ   âŸ¨ functoriality-â—†-â‡ƒ[]â‡‚-CtxFor âŸ©-â‰¡
                  Î“ â‡ƒ[ Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ â—† (Î¹â‚€ â—† Ïˆâ»Â¹)) ]â‡‚á¶œ       âŸ¨ Î“ â‡ƒ[â‰€ lem-03 â‰€]â‡‚á¶œ âŸ©-â‰¡
                  Î“ â‡ƒ[ Ïƒáµƒáµ¤â‚‚ â—† Î¹â‚€ ]â‡‚á¶œ           âŸ¨ sym-Path functoriality-â—†-â‡ƒ[]â‡‚-CtxFor âŸ©-â‰¡
                  Î“ â‡ƒ[ Ïƒáµƒáµ¤â‚‚ ]â‡‚á¶œ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ      âˆ-â‰¡
        -}

        postulate lem-04b : Î±â‚ â‡ƒ[ Î¹â‚€ â‡ƒâŠ”â‡‚ id ]â‡‚ â‡ƒ[ â¦— id , elim-âŠ¥ â¦˜ ]â‡‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚ â‰¡ Î±â‚‚
        {-
        lem-04b = Î±â‚ â‡ƒ[ Î¹â‚€ â‡ƒâŠ”â‡‚ id ]â‡‚ â‡ƒ[ â¦— id , elim-âŠ¥ â¦˜ ]â‡‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚

                  âŸ¨ cong _â‡ƒ[ Ïˆâ»Â¹ ]â‡‚ (functoriality-â—†-â‡ƒ[]â‡‚ {Ï„ = Î±â‚} {f = (Î¹â‚€ â‡ƒâŠ”â‡‚ id)} {â¦— id , elim-âŠ¥ â¦˜}) âŸ©-â‰¡

                  Î±â‚ â‡ƒ[ (Î¹â‚€ â‡ƒâŠ”â‡‚ id) â—† â¦— id , elim-âŠ¥ â¦˜ ]â‡‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚

                  âŸ¨ functoriality-â—†-â‡ƒ[]â‡‚ {Ï„ = Î±â‚} {f = (Î¹â‚€ â‡ƒâŠ”â‡‚ id) â—† â¦— id , elim-âŠ¥ â¦˜} {g = Ïˆâ»Â¹} âŸ©-â‰¡

                  Î±â‚ â‡ƒ[ (Î¹â‚€ â‡ƒâŠ”â‡‚ id) â—† â¦— id , elim-âŠ¥ â¦˜ â—† Ïˆâ»Â¹ ]â‡‚

                  âŸ¨ Î±â‚ â‡ƒ[â‰€ lem-04bi â‰€]â‡‚ âŸ©-â‰¡

                  Î±â‚‚

                  âˆ-â‰¡

          where
            lem-04bi : (Î¹â‚€ â‡ƒâŠ”â‡‚ id) â—† â¦— id , elim-âŠ¥ â¦˜ â—† Ïˆâ»Â¹ âˆ¼ â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜
            lem-04bi = (Î¹â‚€ â‡ƒâŠ”â‡‚ id) â—† â¦— id , elim-âŠ¥ â¦˜ â—† Ïˆâ»Â¹  âŸ¨ append-â‡ƒâŠ”â‡‚ â—ˆ refl âŸ©-âˆ¼
                       â¦— (Î¹â‚€ â—† id , id â—† elim-âŠ¥) â¦˜ â—† Ïˆâ»Â¹    âŸ¨ cong-âˆ¼ {{isSetoidHom:â¦—â¦˜}} (unit-r-â—† , unit-l-â—†)â—ˆ refl âŸ©-âˆ¼
                       â¦— (Î¹â‚€ , elim-âŠ¥) â¦˜ â—† Ïˆâ»Â¹              âŸ¨ append-â¦—â¦˜ âŸ©-âˆ¼
                       â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â—† Ïˆâ»Â¹ â¦˜          âŸ¨ cong-âˆ¼ {{isSetoidHom:â¦—â¦˜}} (refl , expand-âŠ¥) âŸ©-âˆ¼
                       â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜                âˆ
        -}


        postulate lem-05 : isTypedâ„’HM (Î¼sâ‚‚â‚ âŠ” (Î¼sâ‚‚â‚“ âŠ” Î¼sâ‚â‚“) âŠ© (_ , Î“â‚‚ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ) âŠ¢ Î±â‚‚ â‡’ Î²â‚‚) (lam te)
        {-
        lem-05 = lam Î±â‚Î“â‚âŠ¢Î²â‚
                 âŸª Â§-isTypedâ„’HM.prop-2 Ïˆâ»Â¹ âŸ«
                 >> isTypedâ„’HM ((Î¼sâ‚‚â‚ âŠ” (Î¼sâ‚‚â‚“ âŠ” Î¼sâ‚â‚“)) âŠ© (Q) , (Î“â‚ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚á¶œ) âŠ¢ _ â‡’ Î²â‚‚) (lam te) <<

                 âŸª transp-isTypedâ„’HM lem-04a (Î» i -> lem-04b i â‡’ Î²â‚‚) âŸ«
        -}


        Î“<Î“â‚‚ : Î“ <Î“ Î“â‚‚
        Î“<Î“â‚‚ = record { fst = Ïƒáµƒáµ¤â‚‚ ; snd = refl-â‰¡ }

        ğ‘‡ : CtxTypingInstance Î“ (lam te)
        ğ‘‡ = Î¼sâ‚‚â‚ / (Î¼sâ‚‚â‚“ âŠ” Î¼sâ‚â‚“) âŠ© Î“â‚‚ , Î±â‚‚ â‡’ Î²â‚‚ , Î“<Î“â‚‚ , (lem-05)


        isInitial:ğ‘‡ : (ğ‘† : CtxTypingInstance Î“ (lam te)) -> ğ‘‡ <TI ğ‘†
        isInitial:ğ‘‡ (Î¼sâ‚ƒâ‚ / Î¼sâ‚ƒâ‚“ âŠ© Î“â‚ƒ , .(_ â‡’ _) , Î“<Î“â‚ƒ , lam {Î± = Î±â‚ƒ} {Î² = Î²â‚ƒ} Î“â‚ƒÎ±â‚ƒâŠ¢Î²â‚ƒ) =
          record { tiSubâ‚ = Ïƒáµƒâ‚‚â‚ƒ ; tiSubâ‚“ = ÏƒË£â‚‚â‚ƒ ; typProof = lem-50 ; subProof = lem-20 }

          where
            Ïƒáµƒáµ¤â‚ƒ : Î¼s âŸ¶ Î¼sâ‚ƒâ‚
            Ïƒáµƒáµ¤â‚ƒ = Î“<Î“â‚ƒ .fst

            Î²â‚ƒ' : â„’HMType âŸ¨(Î¼sâ‚ƒâ‚ âŠ” Î¼sâ‚ƒâ‚“ âŠ” âŠ¥)âŸ©
            Î²â‚ƒ' = Î²â‚ƒ â‡ƒ[ Î¹â‚€ ]â‡‚

            Î“â‚ƒ' : â„’HMCtxFor _ (Î¼sâ‚ƒâ‚ âŠ” Î¼sâ‚ƒâ‚“)
            Î“â‚ƒ' = Î“â‚ƒ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ

            lem-9 : isTypedâ„’HM (Î¼sâ‚ƒâ‚ âŠ” Î¼sâ‚ƒâ‚“ âŠ” âŠ¥ âŠ© (_ , (Î±â‚ƒ âˆ· Î“â‚ƒ') â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ) âŠ¢ Î²â‚ƒ') te
            lem-9 = Î“â‚ƒÎ±â‚ƒâŠ¢Î²â‚ƒ
                    âŸª Â§-isTypedâ„’HM.prop-2 Î¹â‚€ âŸ«

            Î±â‚ƒ' : â„’HMType âŸ¨ Î¼sâ‚ƒâ‚ âŠ” Î¼sâ‚ƒâ‚“ âŸ©
            Î±â‚ƒ' = Î±â‚ƒ â‡ƒ[ â¦— id , elim-âŠ¥ â¦˜ ]â‡‚

            ÏƒÎ±â‚ƒ : st âŸ¶ Î¼sâ‚ƒâ‚ âŠ” Î¼sâ‚ƒâ‚“
            ÏƒÎ±â‚ƒ = â§œsubst (incl Î±â‚ƒ')

            Ïƒáµƒâ‚€â‚ƒ' : Î¼sâ‚€ âŸ¶ Î¼sâ‚ƒâ‚ âŠ” Î¼sâ‚ƒâ‚“
            Ïƒáµƒâ‚€â‚ƒ' = â¦— Ïƒáµƒáµ¤â‚ƒ â—† Î¹â‚€ , ÏƒÎ±â‚ƒ â¦˜

            postulate lem-10a : Î±â‚€ â‡ƒ[ Ïƒáµƒâ‚€â‚ƒ' â‡ƒâŠ”â‡‚ id ]â‡‚ â‰¡ Î±â‚ƒ
            {-
            lem-10a = Î±áµ˜ â‡ƒ[ Î¹â‚ â—† Î¹â‚€ ]â‡‚ â‡ƒ[ Ïƒáµƒâ‚€â‚ƒ' â‡ƒâŠ”â‡‚ id ]â‡‚     âŸ¨ functoriality-â—†-â‡ƒ[]â‡‚ {Ï„ = Î±áµ˜} {f = Î¹â‚ â—† Î¹â‚€} {Ïƒáµƒâ‚€â‚ƒ' â‡ƒâŠ”â‡‚ id} âŸ©-â‰¡
                      Î±áµ˜ â‡ƒ[ Î¹â‚ â—† Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ƒ' â‡ƒâŠ”â‡‚ id) ]â‡‚       âŸ¨ Î±áµ˜ â‡ƒ[â‰€ lem-10ai â‰€]â‡‚ âŸ©-â‰¡
                      Î±áµ˜ â‡ƒ[ ÏƒÎ±â‚ƒ â—† Î¹â‚€ ]â‡‚                       âŸ¨ sym-Path (functoriality-â—†-â‡ƒ[]â‡‚ {Ï„ = Î±áµ˜} {f = ÏƒÎ±â‚ƒ} {Î¹â‚€}) âŸ©-â‰¡
                      Î±áµ˜ â‡ƒ[ ÏƒÎ±â‚ƒ ]â‡‚ â‡ƒ[ Î¹â‚€ ]â‡‚                   âŸ¨ refl-â‰¡ âŸ©-â‰¡
                      Î±â‚ƒ â‡ƒ[ â¦— id , elim-âŠ¥ â¦˜ ]â‡‚ â‡ƒ[ Î¹â‚€ ]â‡‚       âŸ¨ functoriality-â—†-â‡ƒ[]â‡‚ {Ï„ = Î±â‚ƒ} {f = â¦— id , elim-âŠ¥ â¦˜} {Î¹â‚€} âŸ©-â‰¡
                      Î±â‚ƒ â‡ƒ[ â¦— id , elim-âŠ¥ â¦˜ â—† Î¹â‚€ ]â‡‚           âŸ¨ Î±â‚ƒ â‡ƒ[â‰€ Â§-Ï–.prop-1  â‰€]â‡‚ âŸ©-â‰¡
                      Î±â‚ƒ â‡ƒ[ id ]â‡‚                             âŸ¨ functoriality-id-â‡ƒ[]â‡‚ âŸ©-â‰¡
                      Î±â‚ƒ                                      âˆ-â‰¡
              where
                postulate lem-10ai : Î¹â‚ â—† Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ƒ' â‡ƒâŠ”â‡‚ id) âˆ¼ ÏƒÎ±â‚ƒ â—† Î¹â‚€
                {-
                lem-10ai = Î¹â‚ â—† Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ƒ' â‡ƒâŠ”â‡‚ id)     âŸ¨ assoc-l-â—† âŸ©-âˆ¼
                           Î¹â‚ â—† (Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ƒ' â‡ƒâŠ”â‡‚ id))   âŸ¨ refl â—ˆ reduce-Î¹â‚€ âŸ©-âˆ¼
                           Î¹â‚ â—† (Ïƒáµƒâ‚€â‚ƒ' â—† Î¹â‚€)            âŸ¨ assoc-r-â—† âŸ©-âˆ¼
                           (Î¹â‚ â—† Ïƒáµƒâ‚€â‚ƒ') â—† Î¹â‚€            âŸ¨ reduce-Î¹â‚ â—ˆ refl âŸ©-âˆ¼
                           (ÏƒÎ±â‚ƒ) â—† Î¹â‚€                   âˆ
                -}
            -}

            postulate lem-10b : Î“â‚€ â‡ƒ[ Ïƒáµƒâ‚€â‚ƒ' ]â‡‚á¶œ â‰¡ Î“â‚ƒ'
            {-
            lem-10b = Î“ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ â‡ƒ[ Ïƒáµƒâ‚€â‚ƒ' ]â‡‚á¶œ  âŸ¨ functoriality-â—†-â‡ƒ[]â‡‚-CtxFor âŸ©-â‰¡
                      Î“ â‡ƒ[ Î¹â‚€ â—† Ïƒáµƒâ‚€â‚ƒ' ]â‡‚á¶œ       âŸ¨ Î“ â‡ƒ[â‰€ reduce-Î¹â‚€ â‰€]â‡‚á¶œ âŸ©-â‰¡
                      Î“ â‡ƒ[ Ïƒáµƒáµ¤â‚ƒ â—† Î¹â‚€ ]â‡‚á¶œ        âŸ¨ sym-Path functoriality-â—†-â‡ƒ[]â‡‚-CtxFor âŸ©-â‰¡
                      Î“ â‡ƒ[ Ïƒáµƒáµ¤â‚ƒ ]â‡‚á¶œ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ   âŸ¨ cong _â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ (snd Î“<Î“â‚ƒ) âŸ©-â‰¡
                      Î“â‚ƒ â‡ƒ[ Î¹â‚€ ]â‡‚á¶œ              âˆ-â‰¡
            -}

            Î±â‚€Î“â‚€<Î±â‚ƒÎ“â‚ƒ' : (Î±â‚€ âˆ· Î“â‚€) <Î“ (Î±â‚ƒ âˆ· Î“â‚ƒ')
            Î±â‚€Î“â‚€<Î±â‚ƒÎ“â‚ƒ' = record { fst = Ïƒáµƒâ‚€â‚ƒ' ; snd = Î» i â†’ lem-10a i âˆ· lem-10b i }

            Î©R = Î© ((Î¼sâ‚ƒâ‚ âŠ” Î¼sâ‚ƒâ‚“) / âŠ¥ âŠ© Î±â‚ƒ âˆ· Î“â‚ƒ' , Î²â‚ƒ' , Î±â‚€Î“â‚€<Î±â‚ƒÎ“â‚ƒ' , lem-9)

            Ïƒáµƒâ‚â‚ƒ : Î¼sâ‚â‚ âŸ¶ Î¼sâ‚ƒâ‚ âŠ” Î¼sâ‚ƒâ‚“
            Ïƒáµƒâ‚â‚ƒ = tiSubâ‚ Î©R

            ÏƒË£â‚â‚ƒ : Î¼sâ‚â‚“ âŸ¶ (Î¼sâ‚ƒâ‚ âŠ” Î¼sâ‚ƒâ‚“) âŠ” âŠ¥
            ÏƒË£â‚â‚ƒ = tiSubâ‚“ Î©R

            Ïƒáµƒâ‚‚â‚ƒ : Î¼sâ‚‚â‚ âŸ¶ Î¼sâ‚ƒâ‚
            Ïƒáµƒâ‚‚â‚ƒ = Î¹â‚€ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ â—† Ï–â‚€
            -- Ïƒâ‚‚â‚ƒ â—† Ï–â‚€

            ÏƒË£â‚‚â‚ƒ : (Î¼sâ‚‚â‚“ âŠ” Î¼sâ‚â‚“) âŸ¶ Î¼sâ‚ƒâ‚ âŠ” Î¼sâ‚ƒâ‚“
            ÏƒË£â‚‚â‚ƒ = â¦— Î¹â‚ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜

            postulate lem-15 : Ïƒáµƒáµ¤â‚‚ â—† (Î¹â‚€ â—† âŸ¨ Ï• âŸ©) âˆ¼ Î¹â‚€ â—† Ïƒáµƒâ‚€â‚
            {-
            lem-15 = Ïƒáµƒáµ¤â‚‚ â—† (Î¹â‚€ â—† âŸ¨ Ï• âŸ©)             âŸ¨ assoc-r-â—† âŸ©-âˆ¼
                     (Ïƒáµƒáµ¤â‚‚ â—† Î¹â‚€) â—† âŸ¨ Ï• âŸ©             âŸ¨ lem-0 â—ˆ refl âŸ©-âˆ¼
                     Î¹â‚€ â—† Ïƒáµƒâ‚€â‚ â—† âŸ¨ Ï• âŸ©â»Â¹ â—† âŸ¨ Ï• âŸ©     âŸ¨ assoc-l-â—† âŸ©-âˆ¼
                     Î¹â‚€ â—† Ïƒáµƒâ‚€â‚ â—† (âŸ¨ Ï• âŸ©â»Â¹ â—† âŸ¨ Ï• âŸ©)   âŸ¨ refl â—ˆ inv-l-â—† (of Ï•) âŸ©-âˆ¼
                     Î¹â‚€ â—† Ïƒáµƒâ‚€â‚ â—† id                 âŸ¨ unit-r-â—† âŸ©-âˆ¼
                     Î¹â‚€ â—† Ïƒáµƒâ‚€â‚                      âˆ
            -}

            postulate lem-16 : Ïƒáµƒáµ¤â‚‚ â—† (Î¹â‚€ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ) âˆ¼ Ïƒáµƒáµ¤â‚ƒ â—† Î¹â‚€
            {-
            lem-16 = Ïƒáµƒáµ¤â‚‚ â—† (Î¹â‚€ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ)     âŸ¨ assoc-r-â—† âŸ©-âˆ¼
                     Ïƒáµƒáµ¤â‚‚ â—† (Î¹â‚€ â—† âŸ¨ Ï• âŸ©) â—† Ïƒáµƒâ‚â‚ƒ     âŸ¨ lem-15 â—ˆ refl âŸ©-âˆ¼
                     Î¹â‚€ â—† Ïƒáµƒâ‚€â‚ â—† Ïƒáµƒâ‚â‚ƒ               âŸ¨ assoc-l-â—† âŸ©-âˆ¼
                     Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ â—† Ïƒáµƒâ‚â‚ƒ)             âŸ¨ refl â—ˆ subProof Î©R âŸ©-âˆ¼
                     Î¹â‚€ â—† (Ïƒáµƒâ‚€â‚ƒ')                   âŸ¨ reduce-Î¹â‚€ âŸ©-âˆ¼
                     (Ïƒáµƒáµ¤â‚ƒ â—† Î¹â‚€)                    âˆ
            -}

            postulate lem-20 : Ïƒáµƒáµ¤â‚‚ â—† Ïƒáµƒâ‚‚â‚ƒ âˆ¼ Ïƒáµƒáµ¤â‚ƒ
            {-
            lem-20 = Ïƒáµƒáµ¤â‚‚ â—† (Î¹â‚€ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ â—† Ï–â‚€)  âŸ¨ assoc-r-â—† âŸ©-âˆ¼
                     Ïƒáµƒáµ¤â‚‚ â—† (Î¹â‚€ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ) â—† Ï–â‚€  âŸ¨ lem-16 â—ˆ refl âŸ©-âˆ¼
                     Ïƒáµƒáµ¤â‚ƒ â—† Î¹â‚€ â—† Ï–â‚€                   âŸ¨ assoc-l-â—† âŸ©-âˆ¼
                     Ïƒáµƒáµ¤â‚ƒ â—† (Î¹â‚€ â—† Ï–â‚€)                 âŸ¨ refl â—ˆ reduce-Î¹â‚€ âŸ©-âˆ¼
                     Ïƒáµƒáµ¤â‚ƒ â—† id                        âŸ¨ unit-r-â—† âŸ©-âˆ¼
                     Ïƒáµƒáµ¤â‚ƒ                             âˆ
            -}

            postulate lem-30 : Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ âˆ¼ Î¹â‚€ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ
            {-
            lem-30 = cancel-epi {{_}} {{isEpi:epiHom factor:f}} lem-30a
              where
                lem-30a : Ïƒáµƒáµ¤â‚‚ â—† (Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€) âˆ¼ Ïƒáµƒáµ¤â‚‚ â—† (Î¹â‚€ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ)
                lem-30a = Ïƒáµƒáµ¤â‚‚ â—† (Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€)           âŸ¨ assoc-r-â—† âŸ©-âˆ¼
                          (Ïƒáµƒáµ¤â‚‚ â—† Ïƒáµƒâ‚‚â‚ƒ) â—† Î¹â‚€           âŸ¨ lem-20 â—ˆ refl âŸ©-âˆ¼
                          Ïƒáµƒáµ¤â‚ƒ â—† Î¹â‚€                    âŸ¨ lem-16 â»Â¹ âŸ©-âˆ¼
                          Ïƒáµƒáµ¤â‚‚ â—† (Î¹â‚€ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ)   âˆ
            -}

            -------------------------------------------------
            -- these lemmas are needed for the Î±â‚‚ â‡ƒ[ "Ïƒâ‚‚â‚ƒ" ]â‡‚ â‰¡ Î±â‚ƒ proof
            postulate lem-31 : â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ âˆ¼ âŸ¨ ã‚ âŸ©â»Â¹ â—† â¦— âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜
            {-
            lem-31 = â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , â¦— Î¹â‚ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜ â¦˜

                     âŸ¨ cong-âˆ¼ {{isSetoidHom:â¦—â¦˜}} (lem-30 , refl) âŸ©-âˆ¼

                     â¦— Î¹â‚€ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , â¦— Î¹â‚ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜ â¦˜

                     âŸ¨ {!!} âŸ©-âˆ¼

                     âŸ¨ ã‚ âŸ©â»Â¹ â—† â¦— â¦— Î¹â‚€ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , Î¹â‚ â—† âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ â¦˜ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜

                     âŸ¨ refl â—ˆ â¦—â‰€ â¦—â‰€ assoc-l-â—† , assoc-l-â—† â‰€â¦˜ , refl â‰€â¦˜ âŸ©-âˆ¼

                     âŸ¨ ã‚ âŸ©â»Â¹ â—† â¦— â¦— Î¹â‚€ â—† (âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ) , Î¹â‚ â—† (âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ) â¦˜ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜

                     âŸ¨ refl â—ˆ â¦—â‰€ expand-Î¹â‚€,Î¹â‚ â»Â¹ , refl â‰€â¦˜ âŸ©-âˆ¼

                     âŸ¨ ã‚ âŸ©â»Â¹ â—† â¦— âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜

                     âˆ
            -}

            postulate lem-32 : Ïˆâ»Â¹ â—† (âŸ¨ ã‚ âŸ©â»Â¹ â—† â¦— âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜) âˆ¼ â¦— Ïƒáµƒâ‚â‚ƒ , (ÏƒË£â‚â‚ƒ â—† Ï–â‚€) â¦˜
            {-
            lem-32 = (âŸ¨ Ï• âŸ©â»Â¹ â‡ƒâŠ”â‡‚ id) â—† âŸ¨ ã‚ âŸ© â—† (âŸ¨ ã‚ âŸ©â»Â¹ â—† _)

                     âŸ¨ assoc-r-â—† âŸ©-âˆ¼

                     (âŸ¨ Ï• âŸ©â»Â¹ â‡ƒâŠ”â‡‚ id) â—† âŸ¨ ã‚ âŸ© â—† âŸ¨ ã‚ âŸ©â»Â¹ â—† _

                     âŸ¨ assoc-l-â—† â—ˆ refl âŸ©-âˆ¼

                     (âŸ¨ Ï• âŸ©â»Â¹ â‡ƒâŠ”â‡‚ id) â—† (âŸ¨ ã‚ âŸ© â—† âŸ¨ ã‚ âŸ©â»Â¹) â—† _

                     âŸ¨ refl â—ˆ (inv-r-â—† (of ã‚)) â—ˆ refl âŸ©-âˆ¼

                     (âŸ¨ Ï• âŸ©â»Â¹ â‡ƒâŠ”â‡‚ id) â—† id â—† _

                     âŸ¨ unit-r-â—† â—ˆ refl âŸ©-âˆ¼

                     (âŸ¨ Ï• âŸ©â»Â¹ â‡ƒâŠ”â‡‚ id) â—† â¦— âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜

                     âŸ¨ append-â‡ƒâŠ”â‡‚ âŸ©-âˆ¼

                     â¦— âŸ¨ Ï• âŸ©â»Â¹ â—† (âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ) , id â—† (ÏƒË£â‚â‚ƒ â—† Ï–â‚€) â¦˜

                     âŸ¨ â¦—â‰€ assoc-r-â—† âˆ™ (inv-l-â—† (of Ï•) â—ˆ refl) âˆ™ unit-l-â—† , unit-l-â—† â‰€â¦˜ âŸ©-âˆ¼

                     â¦— Ïƒáµƒâ‚â‚ƒ , (ÏƒË£â‚â‚ƒ â—† Ï–â‚€) â¦˜

                     âˆ
            -}

            postulate lem-33 : Î¹â‚€ â—† â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜ â—† (âŸ¨ ã‚ âŸ©â»Â¹ â—† â¦— âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜) âˆ¼ Ïƒáµƒâ‚â‚ƒ
            {-
            lem-33 = Î¹â‚€ â—† â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜ â—† _

                     âŸ¨ reduce-Î¹â‚€ â—ˆ refl âŸ©-âˆ¼

                     Î¹â‚€ â—† Ïˆâ»Â¹ â—† _

                     âŸ¨ assoc-l-â—† âŸ©-âˆ¼

                     Î¹â‚€ â—† (Ïˆâ»Â¹ â—† _)

                     âŸ¨ refl â—ˆ lem-32 âŸ©-âˆ¼

                     Î¹â‚€ â—† â¦— Ïƒáµƒâ‚â‚ƒ , (ÏƒË£â‚â‚ƒ â—† Ï–â‚€) â¦˜

                     âŸ¨ reduce-Î¹â‚€ âŸ©-âˆ¼

                     Ïƒáµƒâ‚â‚ƒ

                     âˆ
            -}


            postulate lem-34 : â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜ â—† (â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜) âˆ¼ (Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id) â—† â¦— id , elim-âŠ¥ â¦˜
            {-
            lem-34 = Â§-Ï–.prop-2 lem-34a
              where
                lem-34a : Î¹â‚€ â—† (â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜ â—† (â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜)) âˆ¼ Î¹â‚€ â—† ((Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id) â—† â¦— id , elim-âŠ¥ â¦˜)
                lem-34a = Î¹â‚€ â—† (â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜ â—† (â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜))

                          âŸ¨ refl â—ˆ (refl â—ˆ lem-31 ) âŸ©-âˆ¼

                          Î¹â‚€ â—† (â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜ â—† (âŸ¨ ã‚ âŸ©â»Â¹ â—† â¦— âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜))

                          âŸ¨ assoc-r-â—† âŸ©-âˆ¼

                          (Î¹â‚€ â—† â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜) â—† (âŸ¨ ã‚ âŸ©â»Â¹ â—† â¦— âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜)

                          âŸ¨ lem-33 âŸ©-âˆ¼

                          Ïƒáµƒâ‚â‚ƒ

                          âŸ¨ unit-r-â—† â»Â¹ âŸ©-âˆ¼

                          Ïƒáµƒâ‚â‚ƒ â—† id

                          âŸ¨ refl â—ˆ reduce-Î¹â‚€ â»Â¹ âŸ©-âˆ¼

                          Ïƒáµƒâ‚â‚ƒ â—† (Î¹â‚€  â—† â¦— id , elim-âŠ¥ â¦˜)

                          âŸ¨ assoc-r-â—† âŸ©-âˆ¼

                          (Ïƒáµƒâ‚â‚ƒ â—† Î¹â‚€ ) â—† â¦— id , elim-âŠ¥ â¦˜

                          âŸ¨ reduce-Î¹â‚€ â»Â¹ â—ˆ refl âŸ©-âˆ¼

                          (Î¹â‚€ â—† (Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id)) â—† â¦— id , elim-âŠ¥ â¦˜

                          âŸ¨ assoc-l-â—† âŸ©-âˆ¼

                          Î¹â‚€ â—† ((Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id) â—† â¦— id , elim-âŠ¥ â¦˜)

                          âˆ
            -}

            postulate lem-35 : Î±â‚ â‡ƒ[ (Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id) ]â‡‚ â‰¡ Î±â‚€ â‡ƒ[ Ïƒáµƒâ‚€â‚ƒ' â‡ƒâŠ”â‡‚ id ]â‡‚
            {-
            lem-35 = Î±â‚ â‡ƒ[ (Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id) ]â‡‚                         âŸ¨ sym-Path (cong _â‡ƒ[ (Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id) ]â‡‚ (Î» i -> split-Listá´°Â² (Î±â‚€Î“â‚€<Î±â‚Î“â‚ .snd i) .fst)) âŸ©-â‰¡
                     Î±â‚€ â‡ƒ[ (Ïƒáµƒâ‚€â‚ â‡ƒâŠ”â‡‚ id) ]â‡‚ â‡ƒ[ (Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id) ]â‡‚     âŸ¨ functoriality-â—†-â‡ƒ[]â‡‚ {Ï„ = Î±â‚€} {f = (Ïƒáµƒâ‚€â‚ â‡ƒâŠ”â‡‚ id)} {(Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id)} âŸ©-â‰¡
                     Î±â‚€ â‡ƒ[ (Ïƒáµƒâ‚€â‚ â‡ƒâŠ”â‡‚ id) â—† (Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id) ]â‡‚         âŸ¨ Î±â‚€ â‡ƒ[â‰€ functoriality-â—†-âŠ” â»Â¹ â‰€]â‡‚ âŸ©-â‰¡
                     Î±â‚€ â‡ƒ[ ((Ïƒáµƒâ‚€â‚ â—† Ïƒáµƒâ‚â‚ƒ) â‡ƒâŠ”â‡‚ (id â—† id)) ]â‡‚             âŸ¨ Î±â‚€ â‡ƒ[â‰€ subProof Î©R â‰€â‡ƒâŠ”â‡‚â‰€ unit-2-â—† â‰€]â‡‚ âŸ©-â‰¡
                     Î±â‚€ â‡ƒ[ (Ïƒáµƒâ‚€â‚ƒ' â‡ƒâŠ”â‡‚ id) ]â‡‚                        âˆ-â‰¡
            -}

            postulate lem-40 : Î±â‚‚ â‡ƒ[ â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ ]â‡‚ â‰¡ Î±â‚ƒ'
            {-
            lem-40 = Î±â‚ â‡ƒ[ â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜ ]â‡‚ â‡ƒ[ â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ ]â‡‚

                     âŸ¨ functoriality-â—†-â‡ƒ[]â‡‚ {Ï„ = Î±â‚} {f = â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜} {â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜} âŸ©-â‰¡

                     Î±â‚ â‡ƒ[ â¦— Î¹â‚€ â—† Ïˆâ»Â¹ , elim-âŠ¥ â¦˜ â—† â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ ]â‡‚

                     âŸ¨ Î±â‚ â‡ƒ[â‰€ lem-34 â‰€]â‡‚ âŸ©-â‰¡

                     Î±â‚ â‡ƒ[ (Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id) â—† â¦— id , elim-âŠ¥ â¦˜ ]â‡‚

                     âŸ¨ sym-Path (functoriality-â—†-â‡ƒ[]â‡‚ {Ï„ = Î±â‚} {f = (Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id)} {â¦— id , elim-âŠ¥ â¦˜}) âŸ©-â‰¡

                     Î±â‚ â‡ƒ[ (Ïƒáµƒâ‚â‚ƒ â‡ƒâŠ”â‡‚ id) ]â‡‚ â‡ƒ[ â¦— id , elim-âŠ¥ â¦˜ ]â‡‚

                     âŸ¨ cong _â‡ƒ[ â¦— id , elim-âŠ¥ â¦˜ ]â‡‚ lem-35 âŸ©-â‰¡

                     Î±â‚€ â‡ƒ[ (Ïƒáµƒâ‚€â‚ƒ' â‡ƒâŠ”â‡‚ id) ]â‡‚ â‡ƒ[ â¦— id , elim-âŠ¥ â¦˜ ]â‡‚

                     âŸ¨ cong _â‡ƒ[ â¦— id , elim-âŠ¥ â¦˜ ]â‡‚ (Î» i -> split-Listá´°Â² (Î±â‚€Î“â‚€<Î±â‚ƒÎ“â‚ƒ' .snd i) .fst) âŸ©-â‰¡

                     Î±â‚ƒ â‡ƒ[ â¦— id , elim-âŠ¥ â¦˜ ]â‡‚

                     âŸ¨ refl-â‰¡ âŸ©-â‰¡

                     Î±â‚ƒ'

                     âˆ-â‰¡
            -}

            -------------------------------------------------------
            -- now the lemmas for Î²â‚‚ â‡ƒ[ "Ïƒâ‚‚â‚ƒ" ]â‡‚ â‰¡ Î²â‚ƒ proof

            postulate lem-41 : Î²â‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚ â‡ƒ[ â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ â—† Î¹â‚€ ]â‡‚ â‰¡ Î²â‚ƒ'
            {-
            lem-41 = Î²â‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚ â‡ƒ[ â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ â—† Î¹â‚€ ]â‡‚

                     âŸ¨ (functoriality-â—†-â‡ƒ[]â‡‚ {Ï„ = Î²â‚} {f = Ïˆâ»Â¹} {â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ â—† Î¹â‚€}) âŸ©-â‰¡

                     Î²â‚ â‡ƒ[ Ïˆâ»Â¹ â—† (â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ â—† Î¹â‚€) ]â‡‚

                     âŸ¨ Î²â‚ â‡ƒ[â‰€ lem-41a â‰€]â‡‚ âŸ©-â‰¡

                     Î²â‚ â‡ƒ[ â¦— Ïƒáµƒâ‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚â‚ƒ â¦˜ ]â‡‚

                     âŸ¨ typProof Î©R âŸ©-â‰¡

                     Î²â‚ƒ'

                     âˆ-â‰¡

              where
                postulate lem-41a : Ïˆâ»Â¹ â—† (â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ â—† Î¹â‚€) âˆ¼ â¦— Ïƒáµƒâ‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚â‚ƒ â¦˜
                {-
                lem-41a = Ïˆâ»Â¹ â—† (â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ â—† Î¹â‚€)

                      âŸ¨ assoc-r-â—† âŸ©-âˆ¼

                      (Ïˆâ»Â¹ â—† â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜) â—† Î¹â‚€

                      âŸ¨ (refl â—ˆ lem-31) â—ˆ refl âŸ©-âˆ¼

                      Ïˆâ»Â¹ â—† (âŸ¨ ã‚ âŸ©â»Â¹ â—† â¦— âŸ¨ Ï• âŸ© â—† Ïƒáµƒâ‚â‚ƒ , ÏƒË£â‚â‚ƒ â—† Ï–â‚€ â¦˜) â—† Î¹â‚€

                      âŸ¨ lem-32 â—ˆ refl âŸ©-âˆ¼

                      â¦— Ïƒáµƒâ‚â‚ƒ , (ÏƒË£â‚â‚ƒ â—† Ï–â‚€) â¦˜ â—† Î¹â‚€

                      âŸ¨ append-â¦—â¦˜ âŸ©-âˆ¼

                      â¦— Ïƒáµƒâ‚â‚ƒ â—† Î¹â‚€ , (ÏƒË£â‚â‚ƒ â—† Ï–â‚€) â—† Î¹â‚€ â¦˜

                      âŸ¨ â¦—â‰€ refl , assoc-l-â—† â‰€â¦˜ âŸ©-âˆ¼

                      â¦— Ïƒáµƒâ‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚â‚ƒ â—† (Ï–â‚€ â—† Î¹â‚€) â¦˜

                      âŸ¨ â¦—â‰€ refl , ((refl â—ˆ Â§-Ï–.prop-1) âˆ™ unit-r-â—†) â‰€â¦˜ âŸ©-âˆ¼

                      â¦— Ïƒáµƒâ‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚â‚ƒ â¦˜

                      âˆ
                -}
            -}

            postulate lem-42 : Î²â‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚ â‡ƒ[ â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ ]â‡‚ â‰¡ Î²â‚ƒ
            {-
            lem-42 = Î²â‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚ â‡ƒ[ â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ ]â‡‚

                     âŸ¨ Î²â‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚ â‡ƒ[â‰€ unit-r-â—† â»Â¹ âˆ™ (refl â—ˆ reduce-Î¹â‚€ â»Â¹) âˆ™ assoc-r-â—† â‰€]â‡‚ âŸ©-â‰¡

                     Î²â‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚ â‡ƒ[ (â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ â—† Î¹â‚€) â—† Ï–â‚€ ]â‡‚

                     âŸ¨ sym-Path (functoriality-â—†-â‡ƒ[]â‡‚ {Ï„ = Î²â‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚} {f = (â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ â—† Î¹â‚€)} {Ï–â‚€}) âŸ©-â‰¡

                     Î²â‚ â‡ƒ[ Ïˆâ»Â¹ ]â‡‚ â‡ƒ[ (â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ â—† Î¹â‚€) ]â‡‚ â‡ƒ[ Ï–â‚€ ]â‡‚

                     âŸ¨ cong _â‡ƒ[ Ï–â‚€ ]â‡‚ lem-41 âŸ©-â‰¡

                     Î²â‚ƒ â‡ƒ[ Î¹â‚€ ]â‡‚ â‡ƒ[ Ï–â‚€ ]â‡‚

                     âŸ¨ functoriality-â—†-â‡ƒ[]â‡‚ {Ï„ = Î²â‚ƒ} {f = Î¹â‚€} {Ï–â‚€} âŸ©-â‰¡

                     Î²â‚ƒ â‡ƒ[ Î¹â‚€ â—† Ï–â‚€ ]â‡‚

                     âŸ¨ Î²â‚ƒ â‡ƒ[â‰€ reduce-Î¹â‚€ â‰€]â‡‚ âŸ©-â‰¡

                     Î²â‚ƒ â‡ƒ[ id ]â‡‚

                     âŸ¨ functoriality-id-â‡ƒ[]â‡‚ âŸ©-â‰¡

                     Î²â‚ƒ

                     âˆ-â‰¡
            -}


            lem-50 : (Î±â‚‚ â‡’ Î²â‚‚) â‡ƒ[ â¦— Ïƒáµƒâ‚‚â‚ƒ â—† Î¹â‚€ , ÏƒË£â‚‚â‚ƒ â¦˜ ]â‡‚ â‰¡ Î±â‚ƒ' â‡’ Î²â‚ƒ
            lem-50 = Î» i -> lem-40 i â‡’ lem-42 i
-}

{-
    -------------------------------------------------
    -- putting it together

    -- distinguish between failure and not
    resn = case res of
      -- if there was a failure,
      -- we also have to fail
      (Î» Â¬typing â†’ left
         -- assume we have a typing for lambda
         -- this means that we also have a typing for te
         -- which we know is impossible
         Î» {(Î½s âŠ© Î” , Ï„ , Î“â‚€<Î” , hastyp)
                â†’ let Î½s' , Î”' , Ï„' , hastyp' = Â§-isTypedâ„’HM.prop-1 te hastyp
                  in {!!} -- Â¬typing (Î½s' âŠ© Î”' , Ï„' , {!!} , hastyp')
                  })
      (right âˆ˜ success)
-}
